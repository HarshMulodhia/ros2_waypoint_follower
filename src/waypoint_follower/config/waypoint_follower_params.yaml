################################################################################
# Autonomous Waypoint Follower - Configuration Parameters
#
# File: waypoint_follower_params.yaml
# Purpose: Centralized parameter configuration for all system components
# Robot: Differential drive, 0.8m x 0.5m, 12kg
# Target Speed: 0.3 m/s (safe indoor operation)
#
# Last Updated: December 21, 2025
################################################################################

waypoint_follower_node:
  ros__parameters:
    # ============================================================================
    # DEBUG & LOGGING
    # ============================================================================
    enable_debug_logging: false
    loglevel: "INFO"  # DEBUG, INFO, WARN, ERROR
    log_period: 5.0

    # ============================================================================
    # QOS SETTINGS
    # ============================================================================
    qos:
      history_depth: 10
      reliability: "RELIABLE"  # RELIABLE or BEST_EFFORT

    # ============================================================================
    # CONTROL LOOP CONFIGURATION
    # ============================================================================
    control_loop_rate: 50.0  # Hz (20ms period)
    dt: 0.02  # Time step in seconds (derived from rate)

    # ============================================================================
    # SPEED & STEERING CONSTRAINTS (TUNED FOR 0.3 m/s)
    # ============================================================================
    max_steering_angle: 0.5  # radians (≈28.6°) - yaw rate limit
    max_linear_velocity: 0.3  # m/s - hard cap for safety
    min_velocity: 0.05  # m/s - minimum speed to prevent stopping

    max_acceleration: 0.2  # m/s² - for smooth acceleration
    velocity_error_threshold: 0.5  # m/s - emergency stop threshold

    # ============================================================================
    # STEERING PID CONTROLLER (Cross-track error correction)
    # ============================================================================
    steering_kp: 1.0  # Proportional gain
    steering_ki: 0.1  # Integral gain
    steering_kd: 0.5  # Derivative gain
    steering_integral_limit: 0.5  # Anti-windup protection (rad)

    # ============================================================================
    # VELOCITY PID CONTROLLER (Speed regulation)
    # ============================================================================
    velocity_kp: 0.5  # Proportional gain
    velocity_ki: 0.05  # Integral gain
    velocity_kd: 0.1  # Derivative gain
    velocity_integral_limit: 0.5  # Anti-windup protection (m/s)

    # ============================================================================
    # TRAJECTORY SMOOTHER PARAMETERS
    # ============================================================================
    trajectory_max_curvature: 1.5  # 1/m (allows ~0.67m radius turns)
    trajectory_interpolation_distance: 0.1  # m (distance between points)

    # ============================================================================
    # PATH TRACKING PARAMETERS
    # ============================================================================
    lookahead_distance_min: 0.3  # m
    lookahead_distance_max: 0.9  # m
    lookahead_velocity_scaling: 1.0  # scaling factor

    # ============================================================================
    # GOAL TOLERANCE & TIMEOUT
    # ============================================================================
    goal_tolerance_distance: 0.1  # m (10cm)
    goal_tolerance_angle: 0.2  # rad (≈11.5°)
    goal_timeout: 60.0  # seconds before declaring unreachable

    # ============================================================================
    # SENSOR FUSION (ODOMETRY + IMU)
    # ============================================================================
    odometry_process_noise: 0.01  # Higher = less trust in motion model
    odometry_measurement_noise: 0.05  # Higher = less trust in sensors
    odometry_timeout: 2.0  # seconds before watchdog triggers
    imu_timeout: 2.0  # seconds before watchdog triggers

    # ============================================================================
    # SAFETY FEATURES
    # ============================================================================
    enable_emergency_stop: true
    enable_curvature_scaling: true
    enable_adaptive_gains: false
    enable_path_smoothing: true

    # ============================================================================
    # TOPICS & FRAMES
    # ============================================================================
    odom_topic: "odometry/filtered"
    imu_topic: "imu/data"
    cmd_vel_topic: "cmd_vel"
    fused_odom_topic: "odometry/fused"
    path_viz_topic: "path_visualization"

    global_frame: "map"
    odom_frame: "odom"
    base_frame: "base_link"

    # ============================================================================
    # WAYPOINT FILE
    # ============================================================================
    waypoints_file: "config/waypoints_course.yaml"  # Can be overridden by launch args

    # ============================================================================
    # ROBOT URDF
    # ============================================================================
    robot_description_param: "robot_description"
